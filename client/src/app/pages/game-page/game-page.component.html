<div class="game-container">
    <!-- First column: Game info -->
    <div class="game-info">
        <div class="game-details">
            <h3>Informations de partie</h3>
            <p>Taille de la carte: {{ game?.size }}x{{ game?.size }}</p>
            <p>Joueurs actuels:</p>
            <!-- Use @for to loop through playerList -->
            @for(player of playerList; track $index){
            <p
                class="player-name"
                [class.player-admin]="player.isAdmin"
                [class.player-regular]="!player.isAdmin"
                [class.abandoned]="player.hasAbandoned"
                [class.active]="player.isActive"
            >
                {{ player.name }} <br />
                Combats gagnés: {{ player.combatWon }}
            </p>
            }
            <p>Joueur actif: {{ lobby.players.length }}</p>
        </div>

        <div class="inventory">
            <h3>Inventaire</h3>
            <!-- Use @for to loop through inventory slots -->
            <div class="inventory-slot" *ngFor="let slot of [0, 1]">(Vide)</div>
        </div>

        <div class="player-info">
            <h3>Informations du joueur</h3>
            <div class="player-header">
                <p class="player-name">{{ clientPlayer.name }}</p>
                <img [src]="clientPlayer.avatar" alt="Avatar du joueur" class="player-avatar" />
            </div>
            <div class="player-stats">
                <div class="health-bar">
                    <span class="health-label">Points de vie: {{ clientPlayer.hp.current }} / {{ clientPlayer.hp.max }}</span>
                    <div class="health-bar-outer">
                        <div class="health-bar-inner" [style.width.%]="(clientPlayer.hp.current / clientPlayer.hp.max) * 100"></div>
                    </div>
                </div>
                <div class="attributes-grid">
                    <div class="attribute">
                        <span class="attribute-label">Rapidité: </span>
                        <span class="attribute-value">{{ clientPlayer.speed }}</span>
                    </div>
                    <div class="attribute">
                        <span class="attribute-label">Attaque: </span>
                        <span class="attribute-value"> {{ clientPlayer.attack.value }} (Bonus: {{ clientPlayer.attack.bonusDice }}) </span>
                    </div>
                    <div class="attribute">
                        <span class="attribute-label">Défense: </span>
                        <span class="attribute-value"> {{ clientPlayer.defense.value }} (Bonus: {{ clientPlayer.defense.bonusDice }}) </span>
                    </div>
                </div>
                <div class="dice-type">
                    <span class="dice-label">Dés assignés: </span>
                    <span class="dice-value">{{ clientPlayer.attack.bonusDice }}</span>
                </div>
                <div class="resources">
                    <div class="resource">
                        <span class="resource-label">Mouvements restants: </span>
                        <span class="resource-value">{{ clientPlayer.movementPoints }}</span>
                    </div>
                    <div class="resource">
                        <span class="resource-label">Actions restantes: </span>
                        <span class="resource-value">{{ clientPlayer.actionPoints }}</span>
                    </div>
                    <div class="ressource">
                        <span class="resource-label">Combats gagnés: </span>
                        <span class="resource-value">{{ clientPlayer.combatWon }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Second column: Game grid and action buttons -->
    <div class="game-map-container">
        <div class="game-map">
            <app-grid
                [grid]="game?.grid"
                [isActionMode]="isActionMode"
                [availablePath]="availablePath"
                [quickestPath]="quickestPath"
                [isEditionMode]="false"
                (tileHovered)="updateQuickestPath($event)"
                (tileClicked)="handleTileClick($event)"
                (doorClicked)="handleDoorClick($event)"
                (playerAttacked)="handleAttackClick($event)"
            ></app-grid>
        </div>
    </div>

    <!-- Third column: Timer and Chat -->
    <div class="timer-chat-container">
        <div class="timer">
            @if (currentPlayer && clientPlayer.name){ @if (currentPlayer.name === clientPlayer.name) {
            <p>C'est votre tour</p>
            } @else { @if (currentPlayer) {
            <p>C'est le tour à {{ currentPlayer.name }}</p>
            } }
            <p>Temps restant: {{ turnTimer }} secondes</p>
            }
        </div>

        <div class="action-buttons">
            @if(currentPlayer && clientPlayer) { @if(currentPlayer.name === clientPlayer.name){
            <button class="action-btn end-turn" (click)="endTurn()">Terminer tour</button>
            <!-- mettre qd cliquer quil parait plus pr indiquer tes en execute action et donner un feedback visuel qqqpart -->
            <button class="action-btn execute-action" (click)="executeNextAction()">Exécuter action</button>
            }
            <button class="action-btn abandon-game" (click)="abandonGame()">Abandonner</button>
            }
        </div>
        @if(isInCombatMode){
        <div class="dice-buttons">
            <button class="dice" (click)="attack()">Attaquer</button>

            <button
                class="dice"
                (click)="evade()"
                [disabled]="!hasEscapeAttemptsLeft"
                [ngClass]="{ 'disabled-btn': !hasEscapeAttemptsLeft }"
            >
                {{ hasEscapeAttemptsLeft ? "S'Évader" : 'Aucune tentative' }}
            </button>
            @if(attackResult){
                <p>Résultat du combat :</p>
                @if(attackResult.success){
                <p>✅ Victoire! Score Attaque: {{ attackResult.attackScore }}, Score Défense: {{ attackResult.defenseScore }}</p>
                } @else {
                <p>❌ Défaite! Score Attaque: {{ attackResult.attackScore }}, Score Défense: {{ attackResult.defenseScore }}</p>
                }
            }
        </div>
    }
        <div class="game-messages">
            <h3>Messages</h3>
            <div class="message-toggle">
                <button [class.active]="activeTab === 'chat'" (click)="activeTab = 'chat'">Clavardage</button>
                <button [class.active]="activeTab === 'log'" (click)="activeTab = 'log'">Journal de bord</button>
            </div>

            <div class="messages-content" *ngIf="activeTab === 'chat'">
                <p>Panneau des messages (clavardage).</p>
            </div>

            <div class="log-content" *ngIf="activeTab === 'log'">
                @for(entry of logEntries; track $index) {
                <p class="log-entry">
                    {{ entry }}
                </p>
                }
            </div>
        </div>
    </div>
</div>
